# Claude Code 로컬 추론 벤치마크 분석 보고서

## 개요

이 문서는 Claude Code(CC)의 로컬 추론 성능을 분석한 결과입니다. Global settings(oh-my-claudecode + 42개 플러그인 포함)가 적용된 "Normal" 모드와 HOME 환경변수 오버라이드로 깨끗한 상태의 "Clean" 모드를 비교했습니다.

**핵심 결론:** Normal 모드가 Clean 모드 대비 평균 **38% 느림** (약 +46.7초). 이는 추가 도구와 확대된 시스템 프롬프트의 누적 영향입니다.

---

## 테스트 환경

| 항목 | 사양 |
|------|------|
| **모델** | qwen3.5:35b (Qwen3.5-35B-A3B-Q4_K_M.gguf, MoE, 19.7GB) |
| **서버** | llama serve (llama-cpp-ollama-converter) on localhost:11435 |
| **하드웨어** | Mac (Apple Silicon) |
| **캐시 관리** | 각 테스트마다 서버 재시작으로 KV 캐시 초기화 |

---

## 결과 요약

### 전체 성능 비교

| 테스트 | Normal | Clean | 차이 | 증감율 |
|--------|--------|-------|------|--------|
| hello | 117.1s | 73.6s | +43.5s | +59% |
| fibonacci | 129.4s | 87.8s | +41.6s | +47% |
| fastapi | 123.3s | 68.2s | +55.1s | +81% |
| **평균** | **123.3s** | **76.5s** | **+46.7s** | **+61%** |

**해석:** Clean 모드가 더 빠르며, Normal 모드는 약 1분 정도 추가 시간 소요.

---

## 요청 구조 분석

### 첫 번째 요청 크기 비교 (KV 캐시 콜드)

| 컴포넌트 | Normal (138KB) | Clean (95KB) | 차이 |
|---------|---|---|---|
| **시스템 프롬프트** | 19.1KB | 14.9KB | +4.2KB |
| **도구 (tools)** | 22개 / 85.9KB | 18개 / 61.1KB | +4개 (+24.8KB) |
| **메시지 (1차 턴)** | 32.9KB | 19.1KB | +13.8KB |
| **합계** | 138KB | 95KB | **+43KB (+45%)** |

### 요청 크기 구성 비율

```
Normal 모드:
├─ 도구: 85.9KB (62%)
├─ 메시지: 32.9KB (24%)
├─ 시스템: 19.1KB (14%)
└─ 합계: 138KB

Clean 모드:
├─ 도구: 61.1KB (64%)
├─ 메시지: 19.1KB (20%)
├─ 시스템: 14.9KB (16%)
└─ 합계: 95KB
```

**도구가 요청 크기의 60% 이상을 차지합니다.** oh-my-claudecode와 42개의 플러그인이 인스턴스 context window를 크게 증가시킵니다.

---

## 서버 로그 분석

### 응답 시간 분포

| 상황 | Normal | Clean | 비고 |
|------|--------|-------|------|
| **첫 요청 (콜드 캐시)** | ~120s | ~70s | 전체 성능 차이의 주요 원인 |
| **후속 요청 (핫 캐시)** | 3-10s | 3-10s | KV 캐시 효과로 큰 차이 없음 |

### 설정 차이

| 항목 | Normal | Clean |
|------|--------|-------|
| **max_tokens** | 64000 | 32000 |
| **초기 요청 크기** | 138.3KB | 94.7KB |
| **응답 시간 (첫)** | 2m 0s | ~1m |

### 세션 특성

- **다중 턴:** CC는 사용자 프롬프트 1개마다 여러 API 호출 수행
- **내부 작업:** Haiku 모델 호출 관찰 (1.7KB 요청) -> CC가 내부 태스크에 haiku 활용
- **KV 캐시 효과:** 후속 요청은 캐시로 인해 3-10초 범위로 수렴

---

## 핵심 발견

### 1. 도구(Tools)가 주요 병목
- Normal: 85.9KB (요청의 62%)
- Clean: 61.1KB (요청의 64%)
- **차이: +24.8KB (+41%)**

oh-my-claudecode 프레임워크와 42개 플러그인이 22개의 도구를 추가 정의합니다. 이는 매 요청마다 컨텍스트 윈도우에 포함되어야 합니다.

### 2. 메시지 크기 팽창
- Normal: 32.9KB (첫 요청)
- Clean: 19.1KB (첫 요청)
- **차이: +13.8KB (+72%)**

플러그인 시스템이 주입하는 시스템 리마인더와 프롬프트 수정으로 메시지가 70% 증가합니다.

### 3. 시스템 프롬프트 증가
- Normal: 19.1KB
- Clean: 14.9KB
- **차이: +4.2KB (+28%)**

Global instructions (CLAUDE.md, MEMORY.md 등)이 시스템 프롬프트에 포함됩니다.

### 4. 시간 증가가 크기 증가보다 큼
- 크기 증가: 43KB (+45%)
- **시간 증가: 46.7초 (+61%)**

**분석:** 단순한 데이터 크기 증가보다 복잡한 지시문(complex instructions)이 모델의 추론 시간을 더 크게 늘립니다. 도구 정의와 역할 지정이 모델의 의사결정 시간을 증가시킵니다.

### 5. max_tokens 설정 차이
- Normal: 64000 토큰까지 생성 가능
- Clean: 32000 토큰까지 생성 가능

더 큰 토큰 공간이 모델의 생성 과정(generation phase)을 길게 할 수 있습니다.

### 6. KV 캐시의 임계적 중요성
- 첫 요청: 120-70초 차이 발생
- 후속 요청: 3-10초로 수렴
- **결론:** 캐시 계층이 있는 환경(브라우저, 장기 세션)에서는 성능 차이 미미

---

## 결론

### 성능 평가

| 측면 | 평가 |
|------|------|
| **첫 요청 성능** | [WARN] Normal이 약 60% 느림 |
| **후속 요청 성능** | [OK] 차이 거의 없음 (3-10s) |
| **총 요청 크기** | +43KB (45% 증가) |
| **요청당 비용** | 높음 (토큰 기반 API) |

### 권장사항

1. **로컬 추론 (ollama/llama-serve)**: Clean 모드 권장
   - 첫 요청은 약 50초 단축
   - 복잡한 도구 체인이 필요 없는 단순 작업에 최적

2. **클라우드 API (Claude API)**: Normal 모드 무방
   - 첫 요청 비용 증가는 미미
   - 로컬 도구와 플러그인 생산성 이득이 더 큼

3. **세션 길이가 긴 작업**: KV 캐시 활용으로 성능 차이 무의미
   - 후속 요청은 모두 3-10초 범위

4. **최적화 옵션**:
   - 도구 선택지 감소 (필요한 것만 로드)
   - max_tokens 하한선 조정 (64000 -> 32000)
   - 시스템 프롬프트 경량화

### 마지막 평가

oh-my-claudecode 플러그인 시스템의 **48KB 오버헤드는 기능성 이득에 비해 합리적**입니다. 로컬 추론이 병목이라면 Clean 모드를 선택하고, 생산성이 중요하다면 Normal 모드의 추가 시간을 감수할 가치가 있습니다.

---

**테스트 일시:** 2026-02-27
**모델:** Qwen3.5-35B (MoE, 19.7GB)
**환경:** macOS Apple Silicon
